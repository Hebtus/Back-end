<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Source: controllers/authenticationController.js</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="",baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body class="dark" data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="5XXYLQx7Wd6_mxhHG5C67"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Controllers_authenticationController.html">Controllers/authenticationController</a></div><div class="sidebar-section-children"><a href="module-Models_userModel.html">Models/userModel</a></div><div class="sidebar-section-children"><a href="module-Routers_authenticationRouter.html">Routers/authenticationRouter</a></div><div class="sidebar-section-children"><a href="module-Routers_authernticationRouter.html">Routers/authernticationRouter</a></div><div class="sidebar-section-children"><a href="module-Utils.html">Utils</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="K2Y_yjoIQkL2xdbXjuTmu"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Utils.AppError.html">AppError</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="_nJoN_mnbwdkyeqBNuiXz"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Routers_authenticationRouter-PassportRouter.html">PassportRouter</a></div><div class="sidebar-section-children"><a href="module-Routers_authernticationRouter-authernticationRouter.html">authernticationRouter</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="tKsGlOiyESfh933-xHrcB"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#facebookAuth">facebookAuth</a></div><div class="sidebar-section-children"><a href="global.html#googleAuth">googleAuth</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section id="source-page" class="source-page"><header><h1 id="title" class="has-anchor">controllers_authenticationController.js</h1></header><article><pre class="prettyprint source lang-js"><code>const crypto = require('crypto');
//const passport = require('passport');
const jwt = require('jsonwebtoken');
const { promisify } = require('util');
const validator = require('validator');
const User = require('../models/userModel');
const catchAsync = require('../utils/catchAsync');
const AppError = require('../utils/appError');
const sendEmail = require('../utils/email');
const EmailConfirm = require('../models/emailConfirmModel');
const PasswordReset = require('../models/passwordResetModel');
/**
 * The Controller responsible for handling authentication Requests
 * @module Controllers/authenticationController
 */

/**
 * @description - Creates Jwt Token.
 * @param {string} id
 * @returns {Object } JWTtoken
 */
const signToken = (id) =>
  jwt.sign({ id }, process.env.JWT_SECRET, {
    expiresIn: process.env.JWT_EXPIRES_IN,
  });

//creates token and attaches it to cookie.
const createToken = (user, res) => {
  const token = signToken(user._id);
  const cookieOptions = {
    expires: new Date(
      Date.now() + process.env.JWT_COOKIE_EXPIRES_IN * 24 * 60 * 60 * 1000
    ),
    httpOnly: true,
  };
  //only for deployment
  if (process.env.NODE_ENV === 'production') cookieOptions.secure = true;

  res.cookie('jwt', token, cookieOptions);
};

//creates token, attaches it to cookie and sends it as a standard responsee
const createSendToken = (user, statusCode, res) => {
  // const token = signToken(user._id);
  // const cookieOptions = {
  //   expires: new Date(
  //     Date.now() + process.env.JWT_COOKIE_EXPIRES_IN * 24 * 60 * 60 * 1000
  //   ),
  //   httpOnly: true,
  // };
  // //only for deployment
  // if (process.env.NODE_ENV === 'production') cookieOptions.secure = true;
  createToken(user, res);
  // res.cookie('jwt', token, cookieOptions);

  // Remove password from output
  user.password = undefined;

  res.status(statusCode).json({
    status: 'success',
    data: {
      user,
    },
  });
};
/**
 * @description - deactivates the email of the current logged in user but has to enter his password for security purposes
 * @param {object} req  -The request object
 * @param {object} res  -The response object
 * @param {object} next -The next object for express middleware
 * @param {object} next -The next object for express middleware
 */
exports.protect = catchAsync(async (req, res, next) => {
  // 1) Getting token and check of it's there
  let token;
  if (
    req.headers.authorization &amp;&amp;
    req.headers.authorization.startsWith('Bearer')
  ) {
    token = req.headers.authorization.split(' ')[1];
  }

  if (!token) {
    return next(
      new AppError('You are not logged in! Please log in to get access.', 401)
    );
  }

  // 2) Verification token

  // 5 HOURS OF JOSEPH'S LIFE LESSON: DON'T PUT TRY CATCH HERE
  // let decoded;
  // try {
  //   // handles when somehow the a cookie named jwt starting with bearer but is invalid comes
  //   decoded = await promisify(jwt.verify)(token, process.env.JWT_SECRET);
  //   next();
  // } catch (err) {
  //   return next(new AppError('Token not verified.', 401));
  // }

  //still needs to handle invalid token error tho I think
  const decoded = await promisify(jwt.verify)(
    token,
    process.env.JWT_SECRET
  ).catch((error) => {
    next(new AppError('Could not decode token.', 401));
    // Handle the error.
  });
  // const decoded = await promisify(jwt.verify, (result, lol) => {
  //   next(new AppError('Could not decode token.', 401));
  // })(token, process.env.JWT_SECRET);
  // 3) Check if user still exists
  const currentUser = await User.findById(decoded.id);
  if (!currentUser) {
    return next(
      new AppError(
        'The user belonging to this token does no longer exist.',
        401
      )
    );
  }

  // 4) Check if user changed password after the token was issued
  if (currentUser.changedPasswordAfter(decoded.iat)) {
    return next(
      new AppError('User recently changed password! Please log in again.', 401)
    );
  }
  //we'll see if we add changed pass after or just use changed at and compare hashoof kda
  // GRANT ACCESS TO PROTECTED ROUTE
  req.user = currentUser;
  next();
});

/**
 * @description - Creates confirmEmail token and sends it via email.
 * @param {object} user -The user document
 * @param {object} req  -The request object
 * @param {object} res  -The response object
 * @param {object} next -The next object for express middleware
 */
const SendConfirmationEmail = async (user, req, res, next) => {
  //generate confirm token first
  const confirmToken = await EmailConfirm.createEmailConfirmToken(user._id);
  const confirmURL = `${req.protocol}://${req.get(
    'host'
  )}/api/v1/signup-confirm/${confirmToken}`;

  const message = `Thank you for signing up! To complete creating your account please verify your email address: ${confirmURL}.\n`;

  try {
    await sendEmail({
      email: user.email,
      subject: 'Verify your Hebtus Account ',
      message,
    });

    res.status(200).json({
      status: 'success',
      message: 'Check your email for confirmation!',
    });
  } catch (err) {
    //delete user and respective confirmation token
    await EmailConfirm.findOneAndDelete({ userID: user._id });
    await User.findByIdAndDelete(user._id);
    return next(
      new AppError('There was an error sending the email. Try again later!'),
      500
    );
  }
};

//  * @exports authenticationController:signup

/**
 * @description  Handles the Sign up request.
 */
exports.signup = catchAsync(async (req, res, next) => {
  //check if user exists:
  const existingUser = await User.findOne({
    email: req.body.email,
  });
  if (existingUser !== null) {
    const emailconfirm = await EmailConfirm.findOne({
      userID: existingUser._id,
    });

    if (emailconfirm !== null) {
      // console.log('emailconfirm is', emailconfirm);
      //already sent before
      return res.status(400).json({
        status: 'fail',
        message: 'Email confirmation already sent!',
      });

      //not found, then either he had already confirmed
    } else if (existingUser.accountConfirmation) {
      exports.login(req, res, next);
    } else {
      // or the token had expired and was removed from DB
      SendConfirmationEmail(existingUser, req, res, next);
    }

    return;
  }

  //login already checks for password and email
  // so we check here also
  if (
    !req.body.password ||
    !req.body.email ||
    !req.body.name.firstName ||
    !req.body.name.lastName
  ) {
    return res.status(400).json({
      status: 'fail',
      message: 'Please Enter password and email and name!',
    });
  }
  if (req.body.password !== req.body.confirmPassword) {
    return res.status(400).json({
      status: 'fail',
      message: 'Password and confirm Passwords do not match!',
    });
    // console.log('lolxd');
  }

  //create user
  const user = await User.create({
    name: req.body.name,
    email: req.body.email,
    password: req.body.password,
    passwordChangedAt: Date.now(), //Not sure of this please check ya yasmine
  });
  SendConfirmationEmail(user, req, res, next);
});

/**
 * @description - Confirms email and then lets user in.
 * @param {object} req  -The request object
 * @param {object} res  -The response object
 * @param {object} next -The next object for express middleware
 */
exports.confirmEmail = catchAsync(async (req, res, next) => {
  // // 1) Get user based on the token
  // console.log('Entered Confirm email route');
  const hashedToken = crypto
    .createHash('sha256')
    .update(req.params.confirmationToken)
    .digest('hex');

  const emailConfirmationDoc = await EmailConfirm.findOne({
    confirmationToken: hashedToken,
    confirmationTokenExpiry: { $gt: Date.now() },
  });
  // // 2) If token has not expired, and there is user, set the new password
  if (!emailConfirmationDoc) {
    return next(new AppError('Token is invalid or has expired', 400));
  }
  // 3) Get user and update relevant info
  const user = await User.findOne({ _id: emailConfirmationDoc.userID });

  user.accountConfirmation = true;
  await user.save();

  //delete confirmation (if the code reaches here aslun??? )
  await EmailConfirm.deleteOne(emailConfirmationDoc);
  // // 4) Log the user in, send JWT
  // createSendToken(user, 200, req, res);
  createSendToken(user, 200, res);
});

/**
 * @description - Handles Login request.
 */
exports.login = catchAsync(async (req, res, next) => {
  const { email, password } = req.body;
  // 1) Check if email and password exist
  if (!email || !password) {
    return res.status(401).json({
      status: 'fail',
      message: 'Please provide email and password!',
    });
    next();
  }
  // 2) Check if user exists &amp;&amp; password is correct
  const user = await User.findOne({ email }).select('+password');

  if (!user || !(await user.correctPassword(password, user.password))) {
    return res.status(401).json({
      status: 'fail',
      message: 'Incorrect email or password!',
    });
    next();
  }
  if (!user.accountConfirmation) {
    // return next(new AppError('User not confirmed', 401));
    return res.status(401).json({
      status: 'fail',
      message: 'User not confirmed, please confirm the user through email!',
    });
    // next();
  }

  // console.log('user is ', user);
  // await user.save({ validateBeforeSave: 0 }); //to handle password changed at
  await user.save(); //to handle password changed at
  // 4) If everything ok, send token to client
  createSendToken(user, 200, res);
});

/**
 * @description - Handles the logout logic.
 */
exports.logout = catchAsync(async (req, res, next) => {
  //overwrite cookie at client side and set it to expire
  res.cookie('jwt', 'loggedout', {
    // expires: new Date(Date.now() + 500),
    expires: new Date(Date.now() - 10 * 1000), //set expiry date to time in past
    httpOnly: true,
  });
  res
    .status(200)
    .json({ status: 'success', message: 'Successfully logged out' });
});

/**


@function
@description Send a password reset token to the user's email address.
@async
@name forgotPassword
@param {object} req - Express request object.
@param {object} res - Express response object.
@param {function} next - Express next middleware function.
@throws {AppError} If the email address is not valid or the user is not found.
@throws {AppError} If there is an error sending the reset email.
@returns {Promise&lt;void>} Sends a JSON response with a success or failure message.
*/
exports.forgotPassword = catchAsync(async (req, res, next) => {
  // 1) Get user based on posted email
  const { email } = req.body;
  if (!(email &amp;&amp; validator.isEmail(email))) {
    // return next(new AppError('Please provide a valid email address', 400));
    return res.status(400).json({
      status: 'failed',
      message: 'Please provide a valid email address',
    });
  }
  const user = await User.findOne({ email });
  if (!user) {
    return res.status(404).json({
      status: 'failed',
      message: 'There is no user with this email address',
    });
    //return next(new AppError('There is no user with this email address', 404));
  }

  // 2) Create random reset token
  const resetToken = await PasswordReset.createResetPasswordToken(user._id);

  //3) send the reset token to the user email address
  const resetURL = `${req.protocol}://${req.get(
    'host'
  )}/api/v1/resetpassword/${resetToken}`;
  const message = `Forgot your password lol ? Submit a PATCH request with your new password and passwordConfirm to: ${resetURL}.\nIf you didn't forget your password, please ignore this email!`;
  try {
    await sendEmail({
      email: user.email,
      subject: 'Your password reset token (valid for 10 min)',
      message,
    });

    res.status(200).json({
      status: 'success',
      message: 'Token sent to email!',
    });
  } catch (err) {
    user.passwordResetToken = undefined;
    user.passwordResetExpires = undefined;
    await user.save({ validateBeforeSave: false });

    return next(
      new AppError('There was an error sending the email. Try again later!'),
      500
    );
  }

  next();
});
/**
 * @description Reset the user's password.
 * @function
 * @async
 * @param {object} req - Express request object.
 * @param {object} res - Express response object.
 * @param {function} next - Express next function.
 * @returns {Promise&lt;void>} - Promise that resolves once the password reset is complete.
 * @throws {AppError} - Throws an AppError if the token is invalid or has expired.
 */
exports.resetPassword = catchAsync(async (req, res, next) => {
  //1) Get user based on token
  const hashedToken = crypto
    .createHash('sha256')
    .update(req.params.token)
    .digest('hex');

  const passwordResetDoc = await PasswordReset.findOne({
    passwordResetToken: hashedToken,
    passwordResetTokenExpiry: { $gt: Date.now() },
  });
  if (!passwordResetDoc)
    return res.status(400).json({
      status: 'fail',
      message: 'Token is invalid',
    });
  const user = await User.findById(passwordResetDoc.userID);
  if (!user)
    return res.status(400).json({
      status: 'fail',
      message: 'Token is invalid',
    });
  //2) If token not expired and user exists, set the new password
  if (req.body.password !== req.body.confirmPassword)
    return res.status(400).json({
      status: 'fail',
      message: 'confirm password doesnt match',
    });
  user.password = req.body.password;
  user.passwordChangedAt = Date.now();
  passwordResetDoc.passwordResetTokenExpiry = undefined;
  passwordResetDoc.passwordResetToken = undefined;
  await user.save();
  //4) Send JWT to let the user log in
  //A Decision needs to be done here according to complications
  //and discussions with Frontend. -Joseph
  createSendToken(user, 200, res);
  await passwordResetDoc.save();
});

// exports.resetPassword = catchAsync(async (req, res, next) => {
//   res.status('200').json({
//     status: 'success',
//     message: '3azama',
//   });
// });

/**
 * @description - updates current user password
 * @param {object} req  -The request object
 * @param {object} res  -The response object
 * @param {object} next -The next object for express middleware
 * @returns {Object} userObject
 */
exports.updatePassword = catchAsync(async (req, res, next) => {
  // 1) Get user from collection
  const user = await User.findById(req.user._id).select('+password');
  if (!user) throw new AppError('Invalid User', 400);

  //check if password != confirmpassword
  if (req.body.password !== req.body.confirmPassword) {
    res.status(401).json({
      status: 'failed',
      message: 'confirm password doesnt match',
    });
    return next(new AppError('confirm password doesnt match', 401));
  }
  // 2) Check if posted current password is correct
  if (!(await user.correctPassword(req.body.passwordCurrent, user.password))) {
    res.status(401).json({
      status: 'failed',
      message: 'Your current password is wrong.',
    });
    return next(new AppError('Your current password is wrong.', 401));
  }
  // 3) update Password in the DB
  user.password = req.body.password;
  res.status(200).json({
    status: 'success',
    message: 'password updated successfully',
  });
  await user.save();
  // User.findByIdAndUpdate will NOT work as intended!
});
</code></pre></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="5XXYLQx7Wd6_mxhHG5C67"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Controllers_authenticationController.html">Controllers/authenticationController</a></div><div class="sidebar-section-children"><a href="module-Models_userModel.html">Models/userModel</a></div><div class="sidebar-section-children"><a href="module-Routers_authenticationRouter.html">Routers/authenticationRouter</a></div><div class="sidebar-section-children"><a href="module-Routers_authernticationRouter.html">Routers/authernticationRouter</a></div><div class="sidebar-section-children"><a href="module-Utils.html">Utils</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="K2Y_yjoIQkL2xdbXjuTmu"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Utils.AppError.html">AppError</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="_nJoN_mnbwdkyeqBNuiXz"><div>Namespaces</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-Routers_authenticationRouter-PassportRouter.html">PassportRouter</a></div><div class="sidebar-section-children"><a href="module-Routers_authernticationRouter-authernticationRouter.html">authernticationRouter</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="tKsGlOiyESfh933-xHrcB"><div>Global</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="global.html#facebookAuth">facebookAuth</a></div><div class="sidebar-section-children"><a href="global.html#googleAuth">googleAuth</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>